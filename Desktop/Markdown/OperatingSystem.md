# Operating System

* 没有安装操作系统,计算机**依然可以运行程序**
* 普通用户不能正常使用

#### 操作系统历史

**用户需求提升**和**硬件技术进步**是操作系统发展两大动力
**计算机硬件发展**的四个典型阶段:

1. 电子管
2. 晶体管
3. 集成电路
4. 大规模集成电路

**操作系统**发展的四个典型阶段

1. 手工
2. 单道批处理系统(批量,自动,单道)
	将多个作业输入到磁盘形成作业队列
	操作系统依次自动处理队列中的每个作业
	外设和CPU交替空闲和忙碌,利用效率低
3. 多道批处理系统(多道,并行(宏观),串行(微观))
	存放**多道程序**
	缺点:作业处理时间长,交互能力差,运行时间不确定
4. 分时系统


#### 分时技术与分时操作系统

* 中断技术, 通道技术: 专门处理外设与内存之间数据传输的处理机(通道)
多终端计算机: 
	* 高性能主机 + 多个终端
		* 主机:运算,CPU强大,大容量内存
		* 终端: 输入和显示,通过串口线远程连接至主机
	采用分时技术轮流为每个终端服务

**分时技术**:	主机以**很短**的**时间片**为单位,把CPU轮流分给每个终端使用,直到作业全被执行完.由于**时间片**很短,每个终端都能很快重新获得CPU,得到及时响应.

**等待周期** = **时间片** $\times$ 终端数量

#####　分时系统的特点
* 多路调制性:**多用户**联机使用同一台计算机
* 交互性: 及时响应
* 独占性: 用户感觉独占计算机

* 大型分时系统的实践:Multics

##### UNIX
* 第一个**实用化**的分时操作系统
* 实现了操作系统的**可移植性**
* 实现了硬件无关性
* 引进了特殊文件的概念: 
		把外设看作文件,实现统一管理

#### 典型操作系统类型
* 微机操作系统
* 多处理机
* 网络
* 实时
* 嵌入式
##### 微机系统
Control Program Microprocessor 
* 良好的层次结构,**BIOS**将操作系统和硬件分隔
Mac OSxi
* 最早使用图形界面和鼠标的操作系统
MS DOS
* 磁盘操作系统
* 单用户单任务
Windows
##### 实时操作系统
产生背景:某些任务**优先紧急**处理
强调作业完成时限

##### 嵌入式
约等于实时操作系统

* 软硬件可以裁剪,软硬件一体化
* 典型的嵌入式操作系统: Android,Linux,ucOS

##### 网络操作系统

在普通操作系统的基础上增加了网络通信和网络服务的功能,常见的操作系统都是网络操作系统UNIX,LINUX,WINDOWS

* 网络资源透明存取
* 存取控制

### 操作系统逻辑结构

* 设计逻辑和实现思路

1. 整体式
2. 层次式
3. 微内核式

##### 整体式

以**模块**为基本单位构建

特点：

* 模块设计，编码，调试独立
* 模块调度自由
* 通信多以**全局变量**完成，

缺点：

* 信息传递随意，维护和更新困难

##### 层次式

TCP/IP协议栈，越往底层和硬件联系越紧密，越往上层和用户联系越紧密

分层原则：

* 硬件相关——最底层
* 外部特性——最外层
* 中间层——调用次序或消息传递顺序
* 共性的服务——较低层
* 活跃功能——较低层

优点： 

* 结构清晰，避免循环调用
* 整体问题局部化，系统的正确性容易保证
* 有利于操作系统的扩充，维护和移植

##### 微内核

微内核 + 核外服务器

微内核： 提供os最基本的核心功能和服务

* 实现与硬件紧密相关的处理
* 实现一些较基本的功能
* 负责客服和服务器间的通信
  核外服务器： 完成os的绝大部份服务功能，等待应用程序提出请求
* 由若干服务器或者进程共同构成

### CPU的态

支持OS最基本的硬件结构：

1. CPU
2. 内存
3. 中断
4. 时钟

#### CPU态

CPU的工作状态，也是一种对资源和指令使用权限的描述

态主要可分为3类：

1. 核态（kernel mode), 可访问所有资源，使用所有指令，管理程序或OS内核
2. 用户态(User mode)，可访问部分资源，权限受限，用户程序
3. 管态(Supervisor mode)，介于二者之间

##### 用户态和核态的相互转换

用户态向核态转换：

* 用户请求OS提供服务
* 发生中断
* 用户进程产生错误（产生中断）
* 用户态企图执行特权指令

核态向用户态转换：

* 中断返回：IRET

##### 硬件和OS对CPU的观察

* 硬件按照**态**，核态或者用户态，来区分CPU的状态
* OS按**进程**来区分CPU的状态，进程A，进程B，还是进程C

###### Intel CPU的态

* Ring0～Ring3（0为最核心，3为最外层）
* 程序A访问程序B时需要进行权限的检查，也就是对态的检查，比较DPL和RPL
* RPL描述程序段的属性

#### 存储程序和数据的部件

* 按照读写的工作方式： RAM， ROM
* 按照与CPU的联系： 主存，辅存。即是否与CPU交换信息

##### 分级存储系统的工作原理

CPU读取指令或数据时访问顺序：

1. 首先访问高速缓存Cache中的数据，如果需要访问的数据在Cache中，称之为命中
2. 如果没有命中，则CPU会到主存中访问，如果没有，则MISS
3. 再到辅存中访问，如果辅存中也没有，则称之为缺页